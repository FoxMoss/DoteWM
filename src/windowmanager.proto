syntax = "proto3";

enum MouseButtonState {
  MOUSE_LEFT_DOWN = 0;
  MOUSE_LEFT_UP = 1;
  MOUSE_RIGHT_DOWN = 2;
  MOUSE_RIGHT_UP = 3;
}

enum WindowType {
  WINDOW_TYPE_DESKTOP = 0;
  WINDOW_TYPE_DOCK = 1;
  WINDOW_TYPE_TOOLBAR = 2;
  WINDOW_TYPE_MENU = 3;
  WINDOW_TYPE_UTILITY = 4;
  WINDOW_TYPE_SPLASH = 5;
  WINDOW_TYPE_DIALOG = 6;
  WINDOW_TYPE_DROPDOWN_MENU = 7;
  WINDOW_TYPE_POPUP_MENU = 8;
  WINDOW_TYPE_TOOLTIP = 9;
  WINDOW_TYPE_NOTIFICATION = 10;
  WINDOW_TYPE_COMBO = 11;
  WINDOW_TYPE_DND = 12;
  WINDOW_TYPE_NORMAL = 13;
}

// REQUESTS (Browser -> Window Manager)

message WindowRequest {
  uint64 window = 1;
}

message ReloadReply {}

message BrowserStartRequest {}

message WindowMapRequest {
  uint64 window = 1;
  uint32 x = 2;
  uint32 y = 3;
  uint32 width = 4;
  uint32 height = 5;
}

message WindowFocusRequest {
  uint64 window = 1;
}

message FileRegisterRequest {
  string file_path = 1;
}

message LogMessageReply {
  string message = 1;
}

message WindowReorderRequest {
  repeated uint64 windows = 1;
}

message WindowRegisterBorderRequest {
  uint64 window = 1;
  int32 x = 2;  // all of these values are the border around your window
  int32 y = 3;  // like x = -1 means a border one pixel before your window
  int32 width = 4;
  int32 height = 5;
}

message RenderRequest {
  uint64 frame_count = 1;
}

message RunProgramRequest {
  repeated string command = 1;
}

// REPLIES (Window Manager -> Browser)

message WindowIconReply {
  uint64 window = 1;
  string image = 2;
}

message WindowMapReply {
  uint64 window = 1;
  uint32 x = 2;
  uint32 y = 3;
  uint32 width = 4;
  uint32 height = 5;
  bool visible = 6;
  string name = 7;
  bool has_border = 8;
  WindowType type = 9;
}

message WindowFocusReply {
  uint64 window = 1;
}

message MouseMoveReply {
  uint32 x = 1;
  uint32 y = 2;
}

message MousePressReply {
  uint32 x = 1;
  uint32 y = 2;
  MouseButtonState state = 3;
}

message RenderReply {
  uint64 last_frame_observered = 1;
}

message WindowCloseRequest {
  uint64 window = 1;
}

message WindowCloseReply {
  uint64 window = 1;
}

// PROTOCOL WRAPPER

message DataSegment {
  oneof data {
    WindowRequest window_request = 1;
    WindowMapReply window_map_reply = 2;
    WindowMapRequest window_map_request = 3;
    MouseMoveReply mouse_move_reply = 4;
    MousePressReply mouse_press_reply = 5;
    WindowFocusReply window_focus_reply = 6;
    WindowReorderRequest window_reorder_request = 7;
    WindowFocusRequest window_focus_request = 8;
    WindowRegisterBorderRequest window_register_border_request = 9;
    RenderRequest render_request = 10;
    RenderReply render_reply = 11;
    RunProgramRequest run_program_request = 12;
    WindowCloseRequest window_close_request = 13;
    WindowCloseReply window_close_reply = 14;
    FileRegisterRequest file_register_request = 15;
    ReloadReply reload_reply = 16;
    BrowserStartRequest browser_start_request = 17;
    LogMessageReply log_message_reply = 18;
    WindowIconReply window_icon_reply = 19;
  }
}

message Packet {
  repeated DataSegment segments = 1;
}
